<?php

    define('QUOTES', [
        // Warren Buffet
        'Someone\'s sitting in the shade today because someone planted a tree a long time ago.' => 'Warren Buffett',
        'If you aren\'t willing to own a stock for 10 years, don\'t even think about owning it for 10 minutes.' => 'Warren Buffett',
        'The most important investment you can make is in yourself.' => 'Warren Buffett',
        'I will tell you how to become rich. Close the doors. Be fearful when others are greedy. Be greedy when others are fearful.' => 'Warren Buffett',
        'Never depend on a single income. Make an investment to create a second source.' => 'Warren Buffett',
        'No matter how great the talent or efforts, some things just take time. You can\'t produce a baby in one month by getting nine women pregnant.' => 'Warren Buffett',
        'Don\'t pass up something that\'s attractive today because you think you will find something better tomorrow.' => 'Warren Buffett',
        'You only have to do a few things right in your life so long as you don\'t do too many things wrong.' => 'Warren Buffett',

        // Albert Einstein
        'Imagination is everything. It is the preview of life\'s coming attractions.' => 'Albert Einstein',
        'Creativity is seeing what others see and thinking what no one else ever thought.' => 'Albert Einstein',
        'The true sign of intelligence is not knowledge, but imagination.' => 'Albert Einstein',
        'We cannot solve our problems with the same thinking we used when we created them.' => 'Albert Einstein',
        'I have no special talent. I am only passionately curious.' => 'Albert Einstein',
        'The only reason for time is so that everything doesn\'t happen at once.' => 'Albert Einstein',
        'Only a life lived for others is a life worthwhile.' => 'Albert Einstein',
        'It should be possible to explain the laws of physics to a barmaid.' => 'Albert Einstein',
        'Let us not forget that human knowledge and skills alone cannot lead humanity to a happy and dignified life.' => 'Albert Einstein',

        // Marcus Aurelius
        'You have power over your mind - not outside events. Realize this, and you will find strength.' => 'Marcus Aurelius, Meditations',
        'Dwell on the beauty of life. Watch the stars, and see yourself running with them.' => 'Marcus Aurelius, Meditations',
        'The happiness of your life depends upon the quality of your thoughts.' => 'Marcus Aurelius, Meditations',
        'Everything we hear is an opinion, not a fact. Everything we see is a perspective, not the truth.' => 'Marcus Aurelius, Meditations',
        'Waste no more time arguing about what a good man should be. Be one.' => 'Marcus Aurelius, Meditations',
        'If you are distressed by anything external, the pain is not due to the thing itself, but to your estimate of it; and this you have the power to revoke at any moment.' => 'Marcus Aurelius, Meditations',
        'When you arise in the morning think of what a privilege it is to be alive, to think, to enjoy, to love ...' => 'Marcus Aurelius, Meditations',
        'The best revenge is to be unlike him who performed the injury.' => 'Marcus Aurelius, Meditations',
        'Accept the things to which fate binds you, and love the people with whom fate brings you together,but do so with all your heart.' => 'Marcus Aurelius, Meditations',
        'The soul becomes dyed with the colour of its thoughts.' => 'Marcus Aurelius, Meditations',
        'It is not death that a man should fear, but he should fear never beginning to live.' => 'Marcus Aurelius, Meditations',
        'Never let the future disturb you. You will meet it, if you have to, with the same weapons of reason which today arm you against the present.' => 'Marcus Aurelius, Meditations',
        'How much more grievous are the consequences of anger than the causes of it.' => 'Marcus Aurelius, Meditations',

        // Steve Jobs
        'Creativity is just connecting things. When you ask creative people how they did something, they feel a little guilty because they didn\'t really do it, they just saw something. It seemed obvious to them after a while.' => 'Steve Jobs',
        'If you really look closely, most overnight successes took a long time.' => 'Steve Jobs',
        'Innovation distinguishes between a leader and a follower.' => 'Steve Jobs',
        'Your time is limited, so don\'t waste it living someone else\'s life.' => 'Steve Jobs',
        'Don\'t let the noise of others\' opinions drown out your own inner voice.' => 'Steve Jobs',
        'You can\'t connect the dots looking forward; you can only connect them looking backwards. So you have to trust that the dots will somehow connect in your future.' => 'Steve Jobs',
        'Be a yardstick of quality. Some people aren\'t used to an environment where excellence is expected.' => 'Steve Jobs',
        'Stay hungry. Stay foolish.' => 'Steve Jobs',
        'I\'m convinced that about half of what separates the successful entrepreneurs from the nonsuccessful ones is pure perseverance.' => 'Steve Jobs',
        'You can\'t just ask customers what they want and then try to give that to them. By the time you get it built, they\'ll want something new.' => 'Steve Jobs',
        'People think focus means saying yes to the thing you\'ve got to focus on. It means saying no to the hundred other good ideas that there are. You have to pick carefully.' => 'Steve Jobs',
        'We\'re here to put a dent in the universe. Otherwise why else even be here?' => 'Steve Jobs',

        // Busines
        'Success is not final; failure is not fatal: it is the courage to continue that counts.' => 'Winston Churchill',
        'Play by the rules, but be ferocious.' => 'Phil Knight',
        'Business opportunities are like buses, there\'s always another one coming.' => 'Richard Branson',
        'Every problem is a gift—without problems we would not grow.' => 'Anthony Robbins',
        'Success usually comes to those who are too busy to be looking for it.' => 'Henry David Thoreau',
        'There\'s no shortage of remarkable ideas, what\'s missing is the will to execute them.' => 'Seth Godin',
        'I owe my success to having listened respectfully to the very best advice, and then going away and doing the exact opposite.' => 'G.K. Chesterton',
        'I don\'t know the word \'quit.\' Either I never did, or I have abolished it.' => 'Susan Butcher',
        'Far and away the best prize that life offers is the chance to work hard at work worth doing.' => 'Theodore Roosevelt',
        'Almost everything worthwhile carries with it some sort of risk, whether it\'s starting a new business, whether it\'s leaving home, whether it\'s getting married, or whether it\'s flying into space.' => 'Chris Hadfield',
        'Even if you are on the right track, you\'ll get run over if you just sit there.' => 'Will Rodgers',
        'The real test is not whether you avoid this failure, because you won\'t. It\'s whether you let it harden or shame you into inaction, or whether you learn from it; whether you choose to persevere.' => 'Barack Obama',
        'Forget past mistakes. Forget failures. Forget everything except what you\'re going to do now and do it.' => 'William Durant',
        'Character cannot be developed in ease and quiet. Only through experience of trial and suffering can the soul be strengthened, ambition inspired and success achieved.' => 'Helen Keller',
        'The first one gets the oyster, the second gets the shell.' => 'Andrew Carnegie',
        'The way to get started is to quit talking and begin doing.' => 'Walt Disney',
        'Whether you think you can or whether you think you can\'t, you\'re right!' => 'Henry Ford',
        'There are no secrets to success. It is the result of preparation, hard work and learning from failure.' => 'Colin Powell',
        'Success is not the key to happiness. Happiness is the key to success. If you love what you are doing, you will be successful.' => 'Albert Schweitzer',
        'Success is often achieved by those who don\'t know that failure is inevitable.' => 'Coco Chanel',
        'Many of life\'s failures are people who did not realize how close they were to success when they gave up.' => 'Thomas Edison',
        'I feel that luck is preparation meeting opportunity.' => 'Oprah Winfrey',
        'I never dreamed about success. I worked for it.' => 'Estée Lauder', 
        'The only place where success comes before work is in the dictionary.' => 'Vidal Sassoon',
        'The only way around is through.' => 'Robert Frost',
        
        // Creativity
        'Art is the elimination of the unnecessary.' => 'Pablo Picasso',
        'You use a glass mirror to see your face. You use works of art to see your soul.' => 'George Bernard Shaw',
        'A creative life is an amplified life. It\'s a bigger life, a happier life, an expanded life, and a hell of a lot more interesting life' => 'Elizabeth Gilbert',
        'Don\'t wait for inspiration. It comes while working.' => 'Henri Matisse',
        'The worst enemy to creativity is self-doubt.' => 'Sylvia Plath',
        'Creativity is inventing, experimenting, growing, taking risks, breaking rules, making mistakes, and having fun.' => 'Mary Lou Cook',
        'It\'s no good being too easily swayed by people\'s opinions. You have to believe in yourself.' => 'Donatella Versace',
        'There is no doubt that creativity is the most important human resource of all. Without creativity, there would be no progress, and we would be forever repeating the same patterns.' => 'Edward De Bono',
        'Begin by learning to draw and paint like the old masters. After that, you can do as you like; everyone will respect you.' => 'Salvador Dali',
        'You can\'t use up creativity. The more you use, the more you have.' => 'Maya Angelou',
        'There is no innovation and creativity without failure.' => 'Brené Brown',
        'The creative process is a process of surrender, not control.' => 'Bruce Lee',
        'The creative adult is the child who survived.' => 'Ursula Le Guin',
        'Great things are done by a series of small things brought together.' => 'Vincent Van Gogh',
        'Make visible what, without you, might perhaps never have been seen.' => 'Oprah Winfrey',
        'Simplicity is the ultimate sophistication.' => 'Leonardo Da Vinci',
        'Draw the art you want to see, start the business you want to run, play the music you want to hear, write the books you want to read, build the products you want to use - do the work you want to see done.' => 'Austin Kleon',
        'Everything you can imagine is real.' => 'Pablo Picasso',
        'Imagination is the beginning of creation. You imagine what you desire, you will what you imagine, and at last, you create what you will.' => 'George Bernard Shaw',
        'Creativity is… seeing something that doesn\'t exist already. You need to find out how you can bring it into being and that way be a playmate with God.' => 'Michele Shea',
        'Everyone who\'s ever taken a shower has had an idea. It\'s the person who gets out of the shower, dries off, and does something about it who makes a difference.' => 'Nolan Bushnell',
        'Creativity can solve almost any problem. The creative act, the defeat of habit by originality, overcomes everything.' => 'George Lois',
        'Invention, it must be humbly admitted, does not consist in creating out of void but out of chaos.' => 'Mary Shelley',
        'True alchemy lies in this formula: \'Your memory and your senses are but the nourishment of your creative impulse.\'' => 'Arthur Rimbaud',
        'Odd how the creative power at once brings the whole universe to order.' => 'Virginia Woolf',
        
        // Programming
        'Any fool can write code that a computer can understand. Good programmers write code that humans can understand.' => 'Martin Fowler',
        'First, solve the problem. Then, write the code.' => 'John Johnson',
        'Experience is the name everyone gives to their mistakes.' => 'Oscar Wilde',
        'In order to be irreplaceable, one must always be different.' => 'Coco Chanel',
        'Java is to JavaScript what car is to Carpet.' => 'Chris Heilmann',
        'Knowledge is power.' => 'Francis Bacon',
        'Sometimes it pays to stay in bed on Monday, rather than spending the rest of the week debugging Monday\'s code.' => 'Dan Salomon', 
        'Perfection is achieved not when there is nothing more to add, but rather when there is nothing more to take away.' => 'Antoine de Saint-Exupery',
        'Ruby is rubbish! PHP is phpantastic!' => 'Nikita Popov',
        'Code is like humor. When you have to explain it, it\'s bad.' => 'Cory House',
        'Fix the cause, not the symptom.' => 'Steve Maguire',
        'Optimism is an occupational hazard of programming: feedback is the treatment.' => 'Kent Beck',
        'When to use iterative development? You should use iterative development only on projects that you want to succeed.' => 'Martin Fowler',
        'Simplicity is the soul of efficiency.' => 'Austin Freeman',
        'Before software can be reusable it first has to be usable.' => 'Ralph Johnson',
        'Make it work, make it right, make it fast.' => 'Kent Beck',

        // Hacking
        'Amateurs hack systems, professionals hack people.' => 'Bruce Schneier',
        'If you spend more on coffee than on IT security, you will be hacked. What\'s more, you deserve to be hacked.' => 'Richard Clarke',
        'Time is what determines security. With enough time nothing is unhackable.' => 'Aniekee Tochukwu Ezekiel',
        'Yes, I am a criminal. My crime is that of curiosity. My crime is that of outsmarting you, something that you will never forgive me for. I am a hacker, and this is my manifesto. You may stop this individual, but you can\'t stop us all… after all, we\'re all alike.' => 'The Mentor (Loyd Blankenship)',
        'No technology that\'s connected to the Internet is unhackable.' => 'Abhijit Naskar',
        'As a matter of fact, yeah, they were foolproof. The problem is that you don\'t have to protect yourself against fools. You have to protect yourself against people like me.' => 'Jeffery Deaver',
        'Never underestimate the determination of a kid who is time-rich and cash-poor.' => 'Cory Doctorow',
        'It is a fairly open secret that almost all system can be hacked, somehow. It is a less spoken of secret that such hacking has actually gone quite mainstream.' => 'Dan Kaminsky',
        'Most hackers are young because young people tend to be adaptable. As long as you remain adaptable, you can always be a good hacker.' => 'Emmanuel Goldstein',
        'I was addicted to hacking, more for the intellectual challenge, the curiosity, the seduction of adventure; not for stealing, or causing damage or writing computer viruses.' => 'Kevin Mitnick',
        'One single vulnerability all an attacker needs.' => 'Window Snyder',
        'For every lock, there is someone out there trying to pick it or break in.' => 'David Bernstein',
        'There are more hackers breeding every day, and more brilliant minds are turning into hackers. Security has advanced, but so have hackers.' => 'Michael Demon Calce',
        'While many hackers have the knowledge, skills, and tools to attack computer systems, they generally lack the motivation to cause violence or severe economic or social harm.' => 'Dorothy E. Denning',
        'The hacker mindset doesn\'t actually see what happens on the other side, to the victim.' => 'Kevin Mitnick',

        // Others
        'There is nothing impossible to him who will try.' => 'Alexander the Great',
        'When you have a dream, you\'ve got to grab it and never let go.' => 'Carol Burnett',
        'Be courageous. Challenge orthodoxy. Stand up for what you believe in. When you are in your rocking chair talking to your grandchildren many years from now, be sure you have a good story to tell.' => 'Amal Clooney',
        'Success is not final, failure is not fatal: it is the courage to continue that counts.' => 'Winston Churchill',
        'You are never too old to set another goal or to dream a new dream.' => 'Malala Yousafzai',
        'Where your fear is, there is your task.' => 'Carl Jung',
        'Everything you ever wanted is on the other side of fear.' => 'George Adair',
        'You must understand that there is more than one path to the top of the mountain.' => 'Miyamoto Musashi, A Book of Five Rings',
        'A ship in harbor is safe, but that is not what ships are built for.' => 'John A. Shedd'
    ]);
    
    class Helper {

        public static function debug_var(mixed $var, bool $exit = false): void {
            
            echo    '<br>
                    <fieldset style="border: 2px groove red; padding: 0 2rem">
                    <legend style="color: red; font-weight: bold">Debug</legend>
                    <pre style="text-align:left; font-size:12px">';

            switch (gettype($var)) {
                case 'array':
                case 'object':
                    echo htmlentities(print_r($var, true));
                    break;
                case 'string':
                    echo 'string(' . strlen($var) . ') "' . htmlentities($var) . '"';
                    break;
                default:
                    var_dump($var);
            }

            if ($exit) {
                echo "<br><u>Exit called from:</u><br>\t";

                debug_print_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS);

                exit('<br><strong>Execution explicitly terminated using <em>' . __METHOD__ . ' </em>method.</strong>');
            }
            echo '</pre></fieldset>';
        }
    }

    class File {
        public string $name;
        public int $timestamp;
        public int $size;
        public string $icon;

        // CONFIG
        // include sizes for directories (increased overhead)
        private static bool $dir_sizes = true;

        

        public function __construct(string $file_name) {
            $this->name = $file_name;

            $this->timestamp = $this->get_timestamp($file_name);
            $this->size = $this->get_size($file_name, self::$dir_sizes);
            $this->icon = $this->get_icon($file_name);

        }

        public static function format_bytes(int $bytes, bool $base_2 = false): array {
            $prefixes = [
                ['B', 'KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'],
                ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']
            ];
            
            $prefix = $base_2 ? $prefixes[0] : $prefixes[1]; 
            $base = $base_2 ? 1024 : 1000;
            
            // handle division by 0 & logarithm of 0 cases 
            if ($bytes === 0) {
                return ['value' => 0, 'prefix' => $prefix[0]];
            }

            $exponent = floor(log($bytes, $base));

            return ['value' => round($bytes / pow($base, $exponent), 2), 'prefix' => $prefix[$exponent]];
        }

        public static function format_date(int $timestamp): string {
            // day-month-year hours:minutes
            $time_format = 'd-m-Y G:i';

            return date($time_format, $timestamp);
        }

        // used for built-in usort function
        public static function sort_files(int|string $input1, int|string $input2, bool $ascending): int {
            $type1 = gettype($input1);
            $type2 = gettype($input2);

            assert($type1 === $type2, 'Sorting according to distinct data types.');

            if ($type1 === 'integer') {
                return $ascending ? $input1 <=> $input2 : $input2 <=> $input1;

            } elseif ($type1 === 'string') {
                return $ascending ? strcmp($input1, $input2) : strcmp($input2, $input1);

            } else {
                throw new TypeError('Sorting according to incorrect data types.');
            }

        }

        private function get_timestamp(string $file_name): int {

            return filemtime($file_name);
        }

        private function get_size(string $file_name, bool $dir_sizes): int {

            // $file_name = rtrim((str_replace('\\', '/', $file_name)), '/');
            $file_name = realpath($file_name);

            // OS specific checks (faster) || recursive directory traverse (slower)
            if ($dir_sizes && is_dir($file_name)) {
                $os = strtolower(substr(PHP_OS, 0, 3));

                // Windows Host (WIN32, WINNT, Windows)
                if ($os === 'win' && extension_loaded('com_dotnet')) {
                    $obj = new COM('scripting.filesystemobject');

                    if (is_object($obj)) {
                        $ref = $obj->getfolder($file_name);
                        $size = $ref->size;
                        $obj = null;
                        return $size;
                    }
                }
                // Unix Host (Linux, Mac OS)
                if ($os !== 'win') {
                    $io = popen('/usr/bin/du -sb ' . $file_name, 'r');

                    if ($io) {
                        $size = intval(fgets($io, 80));
                        pclose($io);
                        return $size;
                    }
                }
                // if system calls did't work, use slower recursive directory traverse method
                $size = 0;
                $files = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($file_name, FilesystemIterator::SKIP_DOTS));

                foreach ($files as $file) {
                    $size += $file->getSize();
                }
                return $size;

            } else {
                return filesize($file_name);
            }
        }

        private function get_icon(string $file_name): string {
          
            $ext = pathinfo($file_name, PATHINFO_EXTENSION);

            // folder
            if ($ext === '') {
                $folder_name = pathinfo($file_name, PATHINFO_FILENAME);
                $q = 'folder_type_' . $folder_name;
                return (array_key_exists($q, ICONS)) ? $q : ICONS['default_folder'];

            // file
            } else {
                $q = 'file_type_' . $ext;
                return (array_key_exists($q, ICONS)) ? $q : ICONS['default_file'];
            }
        }
    }
    
    // main
    $dir = getcwd();

    // remove '.' -> current dir & '..' parent dir entries
    $file_names = array_values(array_diff(scandir($dir), ['.', '..']));
    $files = [];

    foreach ($file_names as $name) {
        $files[] = new File($name);
    }

    // get random quote
    $random_quote = array_rand(QUOTES);

    // total size of current folder
    $folder_size = 0;

    // GET & POST requests
    switch ($_SERVER['REQUEST_METHOD']) {
        case 'POST' && isset($_POST['open_root']):

            if ((bool) $_POST['open_root'] === true) {
                exec('start ' . __DIR__);
                header('Location: ' . $_SERVER['PHP_SELF']);
                exit();
            }

            break;

        case 'GET' && isset($_GET['C'], $_GET['O']):

            switch ($_GET['C']) {
                case 'N':
                    usort($files, fn(File $file1, File $file2): int => File::sort_files($file1->name, $file2->name,
                        $_GET['O']==='A'));
                    break;
                case 'T':
                    usort($files, fn(File $file1, File $file2): int => File::sort_files($file1->timestamp, $file2->timestamp,
                        $_GET['O']==='A'));
                    break;
                case 'S':
                    usort($files, fn(File $file1, File $file2): int => File::sort_files($file1->size, $file2->size,
                        $_GET['O']==='A'));
                    break;
            }
            break;
    }
?>